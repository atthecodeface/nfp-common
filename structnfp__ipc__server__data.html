<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.6"/>
<title>NFP Example Software: nfp_ipc_server_data Struct Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">NFP Example Software
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.6 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li class="current"><a href="annotated.html"><span>Classes</span></a></li>
      <li><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="annotated.html"><span>Class&#160;List</span></a></li>
      <li><a href="classes.html"><span>Class&#160;Index</span></a></li>
      <li><a href="functions.html"><span>Class&#160;Members</span></a></li>
    </ul>
  </div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Macros</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#pub-attribs">Public Attributes</a> &#124;
<a href="structnfp__ipc__server__data-members.html">List of all members</a>  </div>
  <div class="headertitle">
<div class="title">nfp_ipc_server_data Struct Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p>Internal structure for the state of a server.  
 <a href="structnfp__ipc__server__data.html#details">More...</a></p>
<table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="pub-attribs"></a>
Public Attributes</h2></td></tr>
<tr class="memitem:aeb31972e96f9b1043474a8249f3b1401"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structnfp__ipc__server__data.html#aeb31972e96f9b1043474a8249f3b1401">state</a></td></tr>
<tr class="separator:aeb31972e96f9b1043474a8249f3b1401"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ad3cc017965e9b067a9bb9c2b6656b569"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structnfp__ipc__server__data.html#ad3cc017965e9b067a9bb9c2b6656b569">max_clients</a></td></tr>
<tr class="separator:ad3cc017965e9b067a9bb9c2b6656b569"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a1addfb46f78177ec06e73a3d31c1ce96"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structnfp__ipc__server__data.html#a1addfb46f78177ec06e73a3d31c1ce96">total_clients</a></td></tr>
<tr class="separator:a1addfb46f78177ec06e73a3d31c1ce96"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a5685297b8276545277a7db5b1aa39f10"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structnfp__ipc__server__data.html#a5685297b8276545277a7db5b1aa39f10">pad2</a></td></tr>
<tr class="separator:a5685297b8276545277a7db5b1aa39f10"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a65e8899186292b6bf1bd7b23bb4b535f"><td class="memItemLeft" align="right" valign="top">uint64_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structnfp__ipc__server__data.html#a65e8899186292b6bf1bd7b23bb4b535f">client_mask</a></td></tr>
<tr class="separator:a65e8899186292b6bf1bd7b23bb4b535f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a9facff86360e58656cae6348c9660cdf"><td class="memItemLeft" align="right" valign="top">uint64_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structnfp__ipc__server__data.html#a9facff86360e58656cae6348c9660cdf">active_client_mask</a></td></tr>
<tr class="separator:a9facff86360e58656cae6348c9660cdf"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a4de0e4ce44f021a5e2aedd729088e1ad"><td class="memItemLeft" align="right" valign="top">uint64_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structnfp__ipc__server__data.html#a4de0e4ce44f021a5e2aedd729088e1ad">doorbell_mask</a></td></tr>
<tr class="separator:a4de0e4ce44f021a5e2aedd729088e1ad"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aff7feec62d4cff872132070bd18e15c5"><td class="memItemLeft" align="right" valign="top">uint64_t&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structnfp__ipc__server__data.html#aff7feec62d4cff872132070bd18e15c5">pending_mask</a></td></tr>
<tr class="separator:aff7feec62d4cff872132070bd18e15c5"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a617f91b3cad910a7d030a818c43d0a26"><td class="memItemLeft" align="right" valign="top">char&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structnfp__ipc__server__data.html#a617f91b3cad910a7d030a818c43d0a26">pad</a> [16]</td></tr>
<tr class="separator:a617f91b3cad910a7d030a818c43d0a26"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>Internal structure for the state of a server. </p>
<p>This structure contains the state of the <a class="el" href="structnfp__ipc.html" title="Structure containing all server/client data. ">nfp_ipc</a> server; it is an internal data structure that should not be read or modified by the user of the <a class="el" href="structnfp__ipc.html" title="Structure containing all server/client data. ">nfp_ipc</a> functions, but it is declared here so that the shared data structure (<a class="el" href="structnfp__ipc.html" title="Structure containing all server/client data. ">nfp_ipc</a>) for the client/servers can be defined cleanly.</p>
<p>The structure contains the start of the server and bit masks used for interacting with clients. This structure will be read constantly by the server, and so is made to be exactly one cache line long - it will reside in the L1 or L2 cache of the core running the server process. When a client (infrequently) needs to update the structure (for example when it adds a message for the server) it has to atomically set a bit, and the client process core will have to claim the cache line from the server core (forcing an eviction from the L2 cache of the server core), modify it, write it back to its L2, and the server will (almost immediately) import the modified version back in to its L2 cache. It is critical that this structure does not contain any additional information other than client-to-server interactions; if it did so then the caches would thrash more. </p>
</div><h2 class="groupheader">Member Data Documentation</h2>
<a class="anchor" id="a9facff86360e58656cae6348c9660cdf"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">uint64_t nfp_ipc_server_data::active_client_mask</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Active client mask indicating which clients are fully active </p>

</div>
</div>
<a class="anchor" id="a65e8899186292b6bf1bd7b23bb4b535f"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">uint64_t nfp_ipc_server_data::client_mask</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Client mask with one bit per potentially-active client; the bottom <code>max_clients</code> bits of this mask should be set at all times. </p>

</div>
</div>
<a class="anchor" id="a4de0e4ce44f021a5e2aedd729088e1ad"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">uint64_t nfp_ipc_server_data::doorbell_mask</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Doorbell mask with one bit per client indicating that the client has added a message to its to-server message queue, or that the client has changed state. This has to be atomically set or cleared by the client or server - it cannot be just written (it may just be read though) </p>

</div>
</div>
<a class="anchor" id="ad3cc017965e9b067a9bb9c2b6656b569"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int nfp_ipc_server_data::max_clients</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Maximum number of clients that can connect to the server </p>

</div>
</div>
<a class="anchor" id="a617f91b3cad910a7d030a818c43d0a26"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">char nfp_ipc_server_data::pad[16]</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Padding to ensure this structure is 64B long (one cache line) </p>

</div>
</div>
<a class="anchor" id="a5685297b8276545277a7db5b1aa39f10"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int nfp_ipc_server_data::pad2</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Padding to align other fields to 8B alignment </p>

</div>
</div>
<a class="anchor" id="aff7feec62d4cff872132070bd18e15c5"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">uint64_t nfp_ipc_server_data::pending_mask</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Server-held mask indicating which clients have set their doorbells in the recent past but have not yet been serviced </p>

</div>
</div>
<a class="anchor" id="aeb31972e96f9b1043474a8249f3b1401"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int nfp_ipc_server_data::state</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>State of the server from NFP_IPC_STATE_* </p>

</div>
</div>
<a class="anchor" id="a1addfb46f78177ec06e73a3d31c1ce96"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int nfp_ipc_server_data::total_clients</td>
        </tr>
      </table>
</div><div class="memdoc">
<p>Total number of clients currently connected to the server </p>

</div>
</div>
<hr/>The documentation for this struct was generated from the following file:<ul>
<li>/home/nfp/gavin/nfp-common/host/src/<a class="el" href="nfp__ipc_8c.html">nfp_ipc.c</a></li>
</ul>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Wed Apr 20 2016 15:36:17 for NFP Example Software by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.6
</small></address>
</body>
</html>
