<!DOCTYPE html PUBLIC "-//W3C//DTD XHTML 1.0 Transitional//EN" "http://www.w3.org/TR/xhtml1/DTD/xhtml1-transitional.dtd">
<html xmlns="http://www.w3.org/1999/xhtml">
<head>
<meta http-equiv="Content-Type" content="text/xhtml;charset=UTF-8"/>
<meta http-equiv="X-UA-Compatible" content="IE=9"/>
<meta name="generator" content="Doxygen 1.8.6"/>
<title>NFP Example Software: /home/nfp/gavin/nfp-common/host/src/nfp_ipc.c File Reference</title>
<link href="tabs.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="jquery.js"></script>
<script type="text/javascript" src="dynsections.js"></script>
<link href="search/search.css" rel="stylesheet" type="text/css"/>
<script type="text/javascript" src="search/search.js"></script>
<script type="text/javascript">
  $(document).ready(function() { searchBox.OnSelectItem(0); });
</script>
<link href="doxygen.css" rel="stylesheet" type="text/css" />
</head>
<body>
<div id="top"><!-- do not remove this div, it is closed by doxygen! -->
<div id="titlearea">
<table cellspacing="0" cellpadding="0">
 <tbody>
 <tr style="height: 56px;">
  <td style="padding-left: 0.5em;">
   <div id="projectname">NFP Example Software
   </div>
  </td>
 </tr>
 </tbody>
</table>
</div>
<!-- end header part -->
<!-- Generated by Doxygen 1.8.6 -->
<script type="text/javascript">
var searchBox = new SearchBox("searchBox", "search",false,'Search');
</script>
  <div id="navrow1" class="tabs">
    <ul class="tablist">
      <li><a href="index.html"><span>Main&#160;Page</span></a></li>
      <li><a href="pages.html"><span>Related&#160;Pages</span></a></li>
      <li><a href="annotated.html"><span>Classes</span></a></li>
      <li class="current"><a href="files.html"><span>Files</span></a></li>
      <li>
        <div id="MSearchBox" class="MSearchBoxInactive">
        <span class="left">
          <img id="MSearchSelect" src="search/mag_sel.png"
               onmouseover="return searchBox.OnSearchSelectShow()"
               onmouseout="return searchBox.OnSearchSelectHide()"
               alt=""/>
          <input type="text" id="MSearchField" value="Search" accesskey="S"
               onfocus="searchBox.OnSearchFieldFocus(true)" 
               onblur="searchBox.OnSearchFieldFocus(false)" 
               onkeyup="searchBox.OnSearchFieldChange(event)"/>
          </span><span class="right">
            <a id="MSearchClose" href="javascript:searchBox.CloseResultsWindow()"><img id="MSearchCloseImg" border="0" src="search/close.png" alt=""/></a>
          </span>
        </div>
      </li>
    </ul>
  </div>
  <div id="navrow2" class="tabs2">
    <ul class="tablist">
      <li><a href="files.html"><span>File&#160;List</span></a></li>
      <li><a href="globals.html"><span>File&#160;Members</span></a></li>
    </ul>
  </div>
<!-- window showing the filter options -->
<div id="MSearchSelectWindow"
     onmouseover="return searchBox.OnSearchSelectShow()"
     onmouseout="return searchBox.OnSearchSelectHide()"
     onkeydown="return searchBox.OnSearchSelectKey(event)">
<a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(0)"><span class="SelectionMark">&#160;</span>All</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(1)"><span class="SelectionMark">&#160;</span>Classes</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(2)"><span class="SelectionMark">&#160;</span>Files</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(3)"><span class="SelectionMark">&#160;</span>Functions</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(4)"><span class="SelectionMark">&#160;</span>Variables</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(5)"><span class="SelectionMark">&#160;</span>Typedefs</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(6)"><span class="SelectionMark">&#160;</span>Enumerator</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(7)"><span class="SelectionMark">&#160;</span>Macros</a><a class="SelectItem" href="javascript:void(0)" onclick="searchBox.OnSelectItem(8)"><span class="SelectionMark">&#160;</span>Pages</a></div>

<!-- iframe showing the search results (closed by default) -->
<div id="MSearchResultsWindow">
<iframe src="javascript:void(0)" frameborder="0" 
        name="MSearchResults" id="MSearchResults">
</iframe>
</div>

<div id="nav-path" class="navpath">
  <ul>
<li class="navelem"><a class="el" href="dir_4f7e4242e27b8c8b476722507617a881.html">host</a></li><li class="navelem"><a class="el" href="dir_ee436fe9bbd694a1f99c2ca92ae2568f.html">src</a></li>  </ul>
</div>
</div><!-- top -->
<div class="header">
  <div class="summary">
<a href="#nested-classes">Classes</a> &#124;
<a href="#enum-members">Enumerations</a> &#124;
<a href="#func-members">Functions</a>  </div>
  <div class="headertitle">
<div class="title">nfp_ipc.c File Reference</div>  </div>
</div><!--header-->
<div class="contents">

<p>NFP inter-process communication library.  
<a href="#details">More...</a></p>
<div class="textblock"><code>#include &quot;<a class="el" href="nfp__ipc_8h_source.html">nfp_ipc.h</a>&quot;</code><br/>
<code>#include &lt;stdint.h&gt;</code><br/>
<code>#include &lt;stdio.h&gt;</code><br/>
<code>#include &lt;stdlib.h&gt;</code><br/>
<code>#include &lt;stddef.h&gt;</code><br/>
<code>#include &lt;string.h&gt;</code><br/>
<code>#include &lt;sys/time.h&gt;</code><br/>
<code>#include &lt;sys/types.h&gt;</code><br/>
<code>#include &lt;unistd.h&gt;</code><br/>
<code>#include &lt;time.h&gt;</code><br/>
<code>#include &lt;inttypes.h&gt;</code><br/>
</div><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="nested-classes"></a>
Classes</h2></td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structtimer.html">timer</a></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structnfp__ipc__msg__queue.html">nfp_ipc_msg_queue</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">Internal structure for a message queue.  <a href="structnfp__ipc__msg__queue.html#details">More...</a><br/></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structnfp__ipc__server__data.html">nfp_ipc_server_data</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">Internal structure for the state of a server.  <a href="structnfp__ipc__server__data.html#details">More...</a><br/></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structnfp__ipc__client__data.html">nfp_ipc_client_data</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">Internal structure for a client.  <a href="structnfp__ipc__client__data.html#details">More...</a><br/></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:"><td class="memItemLeft" align="right" valign="top">struct &#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="structnfp__ipc.html">nfp_ipc</a></td></tr>
<tr class="memdesc:"><td class="mdescLeft">&#160;</td><td class="mdescRight">Structure containing all server/client data.  <a href="structnfp__ipc.html#details">More...</a><br/></td></tr>
<tr class="separator:"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="enum-members"></a>
Enumerations</h2></td></tr>
<tr class="memitem:a06fc87d81c62e9abb8790b6e5713c55b"><td class="memItemLeft" align="right" valign="top">enum &#160;</td><td class="memItemRight" valign="bottom">{ <b>TIMER_EXPIRED</b>, 
<b>TIMER_POLL</b>
 }</td></tr>
<tr class="separator:a06fc87d81c62e9abb8790b6e5713c55b"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table><table class="memberdecls">
<tr class="heading"><td colspan="2"><h2 class="groupheader"><a name="func-members"></a>
Functions</h2></td></tr>
<tr class="memitem:a900cbe525b0c3d6329b5aca977d1f261"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="nfp__ipc_8c.html#a900cbe525b0c3d6329b5aca977d1f261">nfp_ipc_client_start</a> (struct <a class="el" href="structnfp__ipc.html">nfp_ipc</a> *<a class="el" href="structnfp__ipc.html">nfp_ipc</a>, const struct <a class="el" href="structnfp__ipc__client__desc.html">nfp_ipc_client_desc</a> *desc)</td></tr>
<tr class="memdesc:a900cbe525b0c3d6329b5aca977d1f261"><td class="mdescLeft">&#160;</td><td class="mdescRight">Start the client.  <a href="#a900cbe525b0c3d6329b5aca977d1f261">More...</a><br/></td></tr>
<tr class="separator:a900cbe525b0c3d6329b5aca977d1f261"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:addf12b6a6a0706ba204a9b40c51e47e2"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="nfp__ipc_8c.html#addf12b6a6a0706ba204a9b40c51e47e2">nfp_ipc_client_stop</a> (struct <a class="el" href="structnfp__ipc.html">nfp_ipc</a> *<a class="el" href="structnfp__ipc.html">nfp_ipc</a>, int client)</td></tr>
<tr class="memdesc:addf12b6a6a0706ba204a9b40c51e47e2"><td class="mdescLeft">&#160;</td><td class="mdescRight">Stop the client.  <a href="#addf12b6a6a0706ba204a9b40c51e47e2">More...</a><br/></td></tr>
<tr class="separator:addf12b6a6a0706ba204a9b40c51e47e2"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a78e185db73410e116648697529667dfa"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="nfp__ipc_8c.html#a78e185db73410e116648697529667dfa">nfp_ipc_size</a> (void)</td></tr>
<tr class="memdesc:a78e185db73410e116648697529667dfa"><td class="mdescLeft">&#160;</td><td class="mdescRight">Provide the size of the basic server/client shared memory structure.  <a href="#a78e185db73410e116648697529667dfa">More...</a><br/></td></tr>
<tr class="separator:a78e185db73410e116648697529667dfa"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a5ff4e191ed48e86793a188ea34df9ac6"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="nfp__ipc_8c.html#a5ff4e191ed48e86793a188ea34df9ac6">nfp_ipc_server_init</a> (struct <a class="el" href="structnfp__ipc.html">nfp_ipc</a> *<a class="el" href="structnfp__ipc.html">nfp_ipc</a>, const struct <a class="el" href="structnfp__ipc__server__desc.html">nfp_ipc_server_desc</a> *desc)</td></tr>
<tr class="memdesc:a5ff4e191ed48e86793a188ea34df9ac6"><td class="mdescLeft">&#160;</td><td class="mdescRight">Initialize an NFP IPC server.  <a href="#a5ff4e191ed48e86793a188ea34df9ac6">More...</a><br/></td></tr>
<tr class="separator:a5ff4e191ed48e86793a188ea34df9ac6"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a0e226a4207b3991530dc36ab259d5a92"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="nfp__ipc_8c.html#a0e226a4207b3991530dc36ab259d5a92">nfp_ipc_server_shutdown</a> (struct <a class="el" href="structnfp__ipc.html">nfp_ipc</a> *<a class="el" href="structnfp__ipc.html">nfp_ipc</a>, int timeout)</td></tr>
<tr class="memdesc:a0e226a4207b3991530dc36ab259d5a92"><td class="mdescLeft">&#160;</td><td class="mdescRight">Shut down the server and inform clients.  <a href="#a0e226a4207b3991530dc36ab259d5a92">More...</a><br/></td></tr>
<tr class="separator:a0e226a4207b3991530dc36ab259d5a92"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a2d42c29fd759f4fc411bf51835410ddd"><td class="memItemLeft" align="right" valign="top">struct <a class="el" href="structnfp__ipc__msg.html">nfp_ipc_msg</a> *&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="nfp__ipc_8c.html#a2d42c29fd759f4fc411bf51835410ddd">nfp_ipc_msg_alloc</a> (struct <a class="el" href="structnfp__ipc.html">nfp_ipc</a> *<a class="el" href="structnfp__ipc.html">nfp_ipc</a>, int size)</td></tr>
<tr class="memdesc:a2d42c29fd759f4fc411bf51835410ddd"><td class="mdescLeft">&#160;</td><td class="mdescRight">Allocate a messsage from the server message heap.  <a href="#a2d42c29fd759f4fc411bf51835410ddd">More...</a><br/></td></tr>
<tr class="separator:a2d42c29fd759f4fc411bf51835410ddd"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:a34635f4d66397baf8379b8eb87523b68"><td class="memItemLeft" align="right" valign="top">void&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="nfp__ipc_8c.html#a34635f4d66397baf8379b8eb87523b68">nfp_ipc_msg_free</a> (struct <a class="el" href="structnfp__ipc.html">nfp_ipc</a> *<a class="el" href="structnfp__ipc.html">nfp_ipc</a>, struct <a class="el" href="structnfp__ipc__msg.html">nfp_ipc_msg</a> *<a class="el" href="structnfp__ipc__msg.html">nfp_ipc_msg</a>)</td></tr>
<tr class="memdesc:a34635f4d66397baf8379b8eb87523b68"><td class="mdescLeft">&#160;</td><td class="mdescRight">Free a messsage back to the server message heap.  <a href="#a34635f4d66397baf8379b8eb87523b68">More...</a><br/></td></tr>
<tr class="separator:a34635f4d66397baf8379b8eb87523b68"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa4f2269e6c881a7986e23e10a557b3c4"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="nfp__ipc_8c.html#aa4f2269e6c881a7986e23e10a557b3c4">nfp_ipc_server_send_msg</a> (struct <a class="el" href="structnfp__ipc.html">nfp_ipc</a> *<a class="el" href="structnfp__ipc.html">nfp_ipc</a>, int client, struct <a class="el" href="structnfp__ipc__msg.html">nfp_ipc_msg</a> *msg)</td></tr>
<tr class="memdesc:aa4f2269e6c881a7986e23e10a557b3c4"><td class="mdescLeft">&#160;</td><td class="mdescRight">Send a message from the server to a client.  <a href="#aa4f2269e6c881a7986e23e10a557b3c4">More...</a><br/></td></tr>
<tr class="separator:aa4f2269e6c881a7986e23e10a557b3c4"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:af09ddb977c2d1b22dc2195f005d9116f"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="nfp__ipc_8c.html#af09ddb977c2d1b22dc2195f005d9116f">nfp_ipc_client_send_msg</a> (struct <a class="el" href="structnfp__ipc.html">nfp_ipc</a> *<a class="el" href="structnfp__ipc.html">nfp_ipc</a>, int client, struct <a class="el" href="structnfp__ipc__msg.html">nfp_ipc_msg</a> *msg)</td></tr>
<tr class="memdesc:af09ddb977c2d1b22dc2195f005d9116f"><td class="mdescLeft">&#160;</td><td class="mdescRight">Send a message from a client to the server.  <a href="#af09ddb977c2d1b22dc2195f005d9116f">More...</a><br/></td></tr>
<tr class="separator:af09ddb977c2d1b22dc2195f005d9116f"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:ab581f8d0e9233f1cc7d95da7ac75519e"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="nfp__ipc_8c.html#ab581f8d0e9233f1cc7d95da7ac75519e">nfp_ipc_server_poll</a> (struct <a class="el" href="structnfp__ipc.html">nfp_ipc</a> *<a class="el" href="structnfp__ipc.html">nfp_ipc</a>, int timeout, struct <a class="el" href="structnfp__ipc__event.html">nfp_ipc_event</a> *event)</td></tr>
<tr class="memdesc:ab581f8d0e9233f1cc7d95da7ac75519e"><td class="mdescLeft">&#160;</td><td class="mdescRight">Server call to poll for messages, or other events.  <a href="#ab581f8d0e9233f1cc7d95da7ac75519e">More...</a><br/></td></tr>
<tr class="separator:ab581f8d0e9233f1cc7d95da7ac75519e"><td class="memSeparator" colspan="2">&#160;</td></tr>
<tr class="memitem:aa6f1c1ce14b0fa1c39be5466561e4f14"><td class="memItemLeft" align="right" valign="top">int&#160;</td><td class="memItemRight" valign="bottom"><a class="el" href="nfp__ipc_8c.html#aa6f1c1ce14b0fa1c39be5466561e4f14">nfp_ipc_client_poll</a> (struct <a class="el" href="structnfp__ipc.html">nfp_ipc</a> *<a class="el" href="structnfp__ipc.html">nfp_ipc</a>, int client, int timeout, struct <a class="el" href="structnfp__ipc__event.html">nfp_ipc_event</a> *event)</td></tr>
<tr class="memdesc:aa6f1c1ce14b0fa1c39be5466561e4f14"><td class="mdescLeft">&#160;</td><td class="mdescRight">Client call to poll for messages, server shutdown, or other events.  <a href="#aa6f1c1ce14b0fa1c39be5466561e4f14">More...</a><br/></td></tr>
<tr class="separator:aa6f1c1ce14b0fa1c39be5466561e4f14"><td class="memSeparator" colspan="2">&#160;</td></tr>
</table>
<a name="details" id="details"></a><h2 class="groupheader">Detailed Description</h2>
<div class="textblock"><p>NFP inter-process communication library. </p>
<p>Copyright (C) 2015-2016, Gavin J Stark. All rights reserved.</p>
<p>Licensed under the Apache License, Version 2.0 (the "License"); you may not use this file except in compliance with the License. You may obtain a copy of the License at</p>
<p><a href="http://www.apache.org/licenses/LICENSE-2.0">http://www.apache.org/licenses/LICENSE-2.0</a></p>
<p>Unless required by applicable law or agreed to in writing, software distributed under the License is distributed on an "AS IS" BASIS, WITHOUT WARRANTIES OR CONDITIONS OF ANY KIND, either express or implied. See the License for the specific language governing permissions and limitations under the License. </p>
</div><h2 class="groupheader">Function Documentation</h2>
<a class="anchor" id="aa6f1c1ce14b0fa1c39be5466561e4f14"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int nfp_ipc_client_poll </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structnfp__ipc.html">nfp_ipc</a> *&#160;</td>
          <td class="paramname"><em>nfp_ipc</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>client</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>timeout</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structnfp__ipc__event.html">nfp_ipc_event</a> *&#160;</td>
          <td class="paramname"><em>event</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Client call to poll for messages, server shutdown, or other events. </p>
<dl class="section return"><dt>Returns</dt><dd>NFP_IPC_EVENT_* enumeration indicating that an event is valid (and <code>event</code> is filled out), or that the timeout occurred, or possibly that the server has shut down and so the client should also do so</dd></dl>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname"><a class="el" href="structnfp__ipc.html" title="Structure containing all server/client data. ">nfp_ipc</a></td><td>Previously initialized server structure</td></tr>
    <tr><td class="paramname">client</td><td>Client number to send the message to</td></tr>
    <tr><td class="paramname">timeout</td><td>Time to wait for events in microseconds; use 0 to return immediately, &lt;0 for indefinitely</td></tr>
    <tr><td class="paramname">event</td><td>Structure to be filled out if a valid event has occurred</td></tr>
  </table>
  </dd>
</dl>
<p>Poll for events on behalf of the <code>client</code> for the specified amount of time. If a valid event occurs then <code>event</code> will be filled out; otherwise (e.g. on timeouts, or if the server has shut down, or if the client is not correctly active) an appropriate return value is used and <code>event</code> is not touched. </p>

</div>
</div>
<a class="anchor" id="af09ddb977c2d1b22dc2195f005d9116f"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int nfp_ipc_client_send_msg </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structnfp__ipc.html">nfp_ipc</a> *&#160;</td>
          <td class="paramname"><em>nfp_ipc</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>client</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structnfp__ipc__msg.html">nfp_ipc_msg</a> *&#160;</td>
          <td class="paramname"><em>msg</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Send a message from a client to the server. </p>
<dl class="section return"><dt>Returns</dt><dd>Zero on success, non-zero on failure</dd></dl>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname"><a class="el" href="structnfp__ipc.html" title="Structure containing all server/client data. ">nfp_ipc</a></td><td>Previously initialized server structure</td></tr>
    <tr><td class="paramname">client</td><td>Client number sending the message</td></tr>
    <tr><td class="paramname">msg</td><td>Message to send</td></tr>
  </table>
  </dd>
</dl>
<p>Send a message from the client to the server. The message has to have been allocated with nfp_ipc_alloc_msg or received from nfp_ipc_client_poll </p>

</div>
</div>
<a class="anchor" id="a900cbe525b0c3d6329b5aca977d1f261"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int nfp_ipc_client_start </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structnfp__ipc.html">nfp_ipc</a> *&#160;</td>
          <td class="paramname"><em>nfp_ipc</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const struct <a class="el" href="structnfp__ipc__client__desc.html">nfp_ipc_client_desc</a> *&#160;</td>
          <td class="paramname"><em>desc</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Start the client. </p>
<dl class="section return"><dt>Returns</dt><dd>Client number allocated, or less than zero on failure</dd></dl>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname"><a class="el" href="structnfp__ipc.html" title="Structure containing all server/client data. ">nfp_ipc</a></td><td>Previously initialized server structure</td></tr>
    <tr><td class="paramname">desc</td><td>Filled-out client descriptor</td></tr>
  </table>
  </dd>
</dl>
<p>Finds a legal, inactive client number within the server, and allocates it and returns that client number.</p>
<p>Internally, if the call added client 'n', then the server <code>active_client_mask</code> will now have bit 'n' set, and <code>total_clients</code> will be incremented</p>
<p>The approach is to select a client that is not active, and try to claim that. If that fails, try again.</p>
<p>If all clients are busy, or the server is shutting down, then the call will fail. </p>

</div>
</div>
<a class="anchor" id="addf12b6a6a0706ba204a9b40c51e47e2"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void nfp_ipc_client_stop </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structnfp__ipc.html">nfp_ipc</a> *&#160;</td>
          <td class="paramname"><em>nfp_ipc</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>client</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Stop the client. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname"><a class="el" href="structnfp__ipc.html" title="Structure containing all server/client data. ">nfp_ipc</a></td><td>Previously initialized server structure</td></tr>
    <tr><td class="paramname">client</td><td>Client number to send the message to</td></tr>
  </table>
  </dd>
</dl>
<p>Stop a client that has previously been started</p>
<p>Sets the state to be shutting down, and alerts server. </p>

</div>
</div>
<a class="anchor" id="a2d42c29fd759f4fc411bf51835410ddd"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">struct <a class="el" href="structnfp__ipc__msg.html">nfp_ipc_msg</a>* nfp_ipc_msg_alloc </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structnfp__ipc.html">nfp_ipc</a> *&#160;</td>
          <td class="paramname"><em>nfp_ipc</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>size</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Allocate a messsage from the server message heap. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname"><a class="el" href="structnfp__ipc.html" title="Structure containing all server/client data. ">nfp_ipc</a></td><td>Previously initialized server structure</td></tr>
    <tr><td class="paramname">size</td><td>Size in bytes of the message payload</td></tr>
  </table>
  </dd>
</dl>
<p>Allocates a message from the server message heap.</p>
<p>The allocate/free process is not cheap, and it is preferable to allocate messages at start of day (for the client, usually) and reuse the messages, rather than allocate and free dynamically. </p>

</div>
</div>
<a class="anchor" id="a34635f4d66397baf8379b8eb87523b68"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void nfp_ipc_msg_free </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structnfp__ipc.html">nfp_ipc</a> *&#160;</td>
          <td class="paramname"><em>nfp_ipc</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structnfp__ipc__msg.html">nfp_ipc_msg</a> *&#160;</td>
          <td class="paramname"><em>nfp_ipc_msg</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Free a messsage back to the server message heap. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname"><a class="el" href="structnfp__ipc.html" title="Structure containing all server/client data. ">nfp_ipc</a></td><td>Previously initialized server structure</td></tr>
    <tr><td class="paramname"><a class="el" href="structnfp__ipc__msg.html" title="Message as seen by clients and servers. ">nfp_ipc_msg</a></td><td>Message returned by either an <code>nfp_ipc_msg_alloc</code> or a poll function call</td></tr>
  </table>
  </dd>
</dl>
<p>Frees the message back to the server message heap, for later allocation.</p>
<p>The allocate/free process is not cheap, and it is preferable to allocate messages at start of day (for the client, usually) and reuse the messages, rather than allocate and free dynamically. </p>

</div>
</div>
<a class="anchor" id="a5ff4e191ed48e86793a188ea34df9ac6"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">void nfp_ipc_server_init </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structnfp__ipc.html">nfp_ipc</a> *&#160;</td>
          <td class="paramname"><em>nfp_ipc</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">const struct <a class="el" href="structnfp__ipc__server__desc.html">nfp_ipc_server_desc</a> *&#160;</td>
          <td class="paramname"><em>desc</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Initialize an NFP IPC server. </p>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname"><a class="el" href="structnfp__ipc.html" title="Structure containing all server/client data. ">nfp_ipc</a></td><td>Storage for <a class="el" href="structnfp__ipc.html" title="Structure containing all server/client data. ">nfp_ipc</a> structure in memory visible to clients and server, of at least <code><a class="el" href="nfp__ipc_8h.html#a78e185db73410e116648697529667dfa" title="Provide the size of the basic server/client shared memory structure. ">nfp_ipc_size()</a></code> bytes</td></tr>
    <tr><td class="paramname">desc</td><td>Structure filled out with maximum number of clients, server name, etc</td></tr>
  </table>
  </dd>
</dl>
<p>Initializes a server with support for up to the supplied maximum number of clients</p>
<p>Clients cannot connect to a server until it has been initialized </p>

</div>
</div>
<a class="anchor" id="ab581f8d0e9233f1cc7d95da7ac75519e"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int nfp_ipc_server_poll </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structnfp__ipc.html">nfp_ipc</a> *&#160;</td>
          <td class="paramname"><em>nfp_ipc</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>timeout</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structnfp__ipc__event.html">nfp_ipc_event</a> *&#160;</td>
          <td class="paramname"><em>event</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Server call to poll for messages, or other events. </p>
<dl class="section return"><dt>Returns</dt><dd>NFP_IPC_EVENT_* enumeration indicating that an event is valid (and <code>event</code> is filled out), or that the timeout occurred</dd></dl>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname"><a class="el" href="structnfp__ipc.html" title="Structure containing all server/client data. ">nfp_ipc</a></td><td>Previously initialized server structure</td></tr>
    <tr><td class="paramname">timeout</td><td>Time to wait for events in microseconds; use 0 to return immediately, &lt;0 for indefinitely</td></tr>
    <tr><td class="paramname">event</td><td>Structure to be filled out if a valid event has occurred</td></tr>
  </table>
  </dd>
</dl>
<p>Poll for events from clients on behalf of for the specified amount of time. If a valid event occurs then <code>event</code> will be filled out; otherwise (e.g. on timeouts) an appropriate return value is used and <code>event</code> is not touched. </p>

</div>
</div>
<a class="anchor" id="aa4f2269e6c881a7986e23e10a557b3c4"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int nfp_ipc_server_send_msg </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structnfp__ipc.html">nfp_ipc</a> *&#160;</td>
          <td class="paramname"><em>nfp_ipc</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>client</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">struct <a class="el" href="structnfp__ipc__msg.html">nfp_ipc_msg</a> *&#160;</td>
          <td class="paramname"><em>msg</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Send a message from the server to a client. </p>
<dl class="section return"><dt>Returns</dt><dd>Zero on success, non-zero on failure</dd></dl>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname"><a class="el" href="structnfp__ipc.html" title="Structure containing all server/client data. ">nfp_ipc</a></td><td>Previously initialized server structure</td></tr>
    <tr><td class="paramname">client</td><td>Client number to send the message to</td></tr>
    <tr><td class="paramname">msg</td><td>Message to send</td></tr>
  </table>
  </dd>
</dl>
<p>Send a message from the server to a client. The message has to have been allocated with <code>nfp_ipc_alloc_msg</code> or received from <code>nfp_ipc_client_poll</code> </p>

</div>
</div>
<a class="anchor" id="a0e226a4207b3991530dc36ab259d5a92"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int nfp_ipc_server_shutdown </td>
          <td>(</td>
          <td class="paramtype">struct <a class="el" href="structnfp__ipc.html">nfp_ipc</a> *&#160;</td>
          <td class="paramname"><em>nfp_ipc</em>, </td>
        </tr>
        <tr>
          <td class="paramkey"></td>
          <td></td>
          <td class="paramtype">int&#160;</td>
          <td class="paramname"><em>timeout</em>&#160;</td>
        </tr>
        <tr>
          <td></td>
          <td>)</td>
          <td></td><td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Shut down the server and inform clients. </p>
<dl class="section return"><dt>Returns</dt><dd>Something indicating how it shut down</dd></dl>
<dl class="params"><dt>Parameters</dt><dd>
  <table class="params">
    <tr><td class="paramname"><a class="el" href="structnfp__ipc.html" title="Structure containing all server/client data. ">nfp_ipc</a></td><td>Previously initialized server structure</td></tr>
    <tr><td class="paramname">timeout</td><td>Time to wait for clients to shutdown; use 0 to return immediately, &lt;0 for indefinitely</td></tr>
  </table>
  </dd>
</dl>
<p>Wait for clients to stop before quitting the server. This will timeout after the given timeout, if that is non-zero. </p>

</div>
</div>
<a class="anchor" id="a78e185db73410e116648697529667dfa"></a>
<div class="memitem">
<div class="memproto">
      <table class="memname">
        <tr>
          <td class="memname">int nfp_ipc_size </td>
          <td>(</td>
          <td class="paramtype">void&#160;</td>
          <td class="paramname"></td><td>)</td>
          <td></td>
        </tr>
      </table>
</div><div class="memdoc">

<p>Provide the size of the basic server/client shared memory structure. </p>
<dl class="section return"><dt>Returns</dt><dd>The size of the structure required for the client/server system, so that it may be allocated in shared memory</dd></dl>
<p>Find the size of shared memory required for the server/client system; this memory has to be accessible by the server and the clients, and it should be cache line aligned. Ideally this is allocated with malloc, for a pthreads approach, or with shm shared memory for separate processes. For the latter, the <code>nfp_support</code> functions may be useful. Note that malloc will not necessarily provide cache-line aligned memory regions. </p>

</div>
</div>
</div><!-- contents -->
<!-- start footer part -->
<hr class="footer"/><address class="footer"><small>
Generated on Wed Apr 20 2016 15:36:17 for NFP Example Software by &#160;<a href="http://www.doxygen.org/index.html">
<img class="footer" src="doxygen.png" alt="doxygen"/>
</a> 1.8.6
</small></address>
</body>
</html>
